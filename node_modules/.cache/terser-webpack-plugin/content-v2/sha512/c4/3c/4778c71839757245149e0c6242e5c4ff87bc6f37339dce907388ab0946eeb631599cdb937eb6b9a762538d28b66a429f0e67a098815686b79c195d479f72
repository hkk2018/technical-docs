{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{218:function(e,t,a){\"use strict\";a.r(t);var n=a(0),r=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[a(\"h1\",{attrs:{id:\"database-mssql\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#database-mssql\"}},[e._v(\"#\")]),e._v(\" Database(Mssql)\")]),e._v(\" \"),a(\"h2\",{attrs:{id:\"installation-configuration\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#installation-configuration\"}},[e._v(\"#\")]),e._v(\" Installation & Configuration\")]),e._v(\" \"),a(\"p\",[e._v(\"When \"),a(\"code\",[e._v(\"An error has occurred while establishing a connection to the server.\")]),e._v(\"\\nMake sure that\")]),e._v(\" \"),a(\"ol\",[a(\"li\",[e._v(\"service is already started.\")]),e._v(\" \"),a(\"li\",[e._v(\"TCP/IP is enabled in SQL Server Configuration.\")]),e._v(\" \"),a(\"li\",[e._v(\"firewall(default port 1433)\")]),e._v(\" \"),a(\"li\",[a(\"code\",[e._v(\"Allow remote connections to this server\")]),e._v(\" in MSSMS is checked.\")])]),e._v(\" \"),a(\"p\",[e._v(\"ref : \"),a(\"a\",{attrs:{href:\"http://sas.tw/sas/redirect.php?tid=10615&goto=lastpost\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"解決SQL Server管理器無法連接遠端資料庫的問題\"),a(\"OutboundLink\")],1)]),e._v(\" \"),a(\"h2\",{attrs:{id:\"to-update-db-but-avoid-replacing-data\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#to-update-db-but-avoid-replacing-data\"}},[e._v(\"#\")]),e._v(\" To update DB but avoid replacing data\")]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"Save \"),a(\"a\",{attrs:{href:\"https://blog.miniasp.com/post/2008/06/05/Find-out-T-SQL-commands-generated-by-SQL-Server-Management-Studio\",target:\"_blank\",rel:\"noopener noreferrer\"}},[a(\"code\",[e._v(\"Change Script\")]),a(\"OutboundLink\")],1),e._v(\" when altering tables.\")]),e._v(\" \"),a(\"li\",[e._v(\"To export stored procedures(or specific tables):\\n\"),a(\"ol\",[a(\"li\",[e._v(\"right click on Db => \"),a(\"code\",[e._v(\"Tasks\")]),e._v(\"(工作)\")]),e._v(\" \"),a(\"li\",[a(\"code\",[e._v(\"Generate Scripts\")]),e._v(\"(產生指令碼)\")]),e._v(\" \"),a(\"li\",[e._v(\"Choose what to save, and click next\")]),e._v(\" \"),a(\"li\",[e._v(\"Choose \"),a(\"code\",[e._v(\"Script DROP and CREATE\")])])])]),e._v(\" \"),a(\"li\",[e._v(\"Probably save some CRUD scripts manually\")])]),e._v(\" \"),a(\"h2\",{attrs:{id:\"make-values-into-dot-separated-string-by-xml-path\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#make-values-into-dot-separated-string-by-xml-path\"}},[e._v(\"#\")]),e._v(\" Make values into dot-separated string by Xml Path\")]),e._v(\" \"),a(\"p\",[e._v(\"Senario：CMS needs to know relationship between new title and its categories(1 to n), but web doesn't for the sake of reducing internete usage.\"),a(\"br\"),e._v(\"\\n（Also for the compatibility against older version sql server, otherwise String_split）\")]),e._v(\" \"),a(\"p\",[e._v(\"Example:\")]),e._v(\" \"),a(\"pre\",[a(\"code\",[e._v(\"SELECT\\n    A,B,...,\\n    iif ( @isWebDisplay = 1, '',\\n        SUBSTRING(\\n            (\\n                SELECT (',' + CAST(cateId AS varchar(100)))\\n                FROM [AgSportDb].[dbo].NewTitleToCate\\n                WHERE NewTitleToCate.newsTitleId = titleId\\n                FOR xml PATH ('')\\n            ), 2, 100\\n        )\\n    ) as cateIds\\n\")])]),e._v(\" \"),a(\"p\",[e._v(\"it's fine to set 3rd param of SUBSTRING with an aribitrary value as long as it's big enough.\"),a(\"br\"),e._v(\"\\nGreat ref：\"),a(\"a\",{attrs:{href:\"https://www.cnblogs.com/doubleliang/archive/2011/07/06/2098775.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"灵活运用 SQL SERVER FOR XML PATH\"),a(\"OutboundLink\")],1)]),e._v(\" \"),a(\"h2\",{attrs:{id:\"t-sql-formatter-won-t-change-case-of-variables\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#t-sql-formatter-won-t-change-case-of-variables\"}},[e._v(\"#\")]),e._v(\" T-Sql Formatter (won't change case of variables)\")]),e._v(\" \"),a(\"p\",[a(\"a\",{attrs:{href:\"https://sql-format.com/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"Sql Formatter\"),a(\"OutboundLink\")],1)]),e._v(\" \"),a(\"h2\",{attrs:{id:\"quirks\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#quirks\"}},[e._v(\"#\")]),e._v(\" Quirks\")]),e._v(\" \"),a(\"ol\",[a(\"li\",[e._v(\"有output parameter的話， c#端一定要接到。\")]),e._v(\" \"),a(\"li\",[e._v(\"某欄位a若為null，不但a=null抓不到，連a=a都抓不到。\")])]),e._v(\" \"),a(\"h2\",{attrs:{id:\"fastest-way-to-copy-stored-procedure\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#fastest-way-to-copy-stored-procedure\"}},[e._v(\"#\")]),e._v(\" Fastest Way to Copy Stored Procedure\")]),e._v(\" \"),a(\"p\",[e._v(\"修改，然後將ALTER改成CREATE\")]),e._v(\" \"),a(\"h2\",{attrs:{id:\"fast-input-params-into-sp-template\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#fast-input-params-into-sp-template\"}},[e._v(\"#\")]),e._v(\" Fast Input Params Into SP Template\")]),e._v(\" \"),a(\"p\",[e._v(\"在新增的SP頁面中按Ctrl+Shift+M\")]),e._v(\" \"),a(\"h2\",{attrs:{id:\"用戶端統計資料\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#用戶端統計資料\"}},[e._v(\"#\")]),e._v(\" 用戶端統計資料\")]),e._v(\" \"),a(\"h3\",{attrs:{id:\"時間單位\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#時間單位\"}},[e._v(\"#\")]),e._v(\" 時間單位\")]),e._v(\" \"),a(\"p\",[e._v(\"毫秒，可測試以\")]),e._v(\" \"),a(\"pre\",[a(\"code\",[e._v(\"WAITFOR DELAY '00:00:01'\\n\")])]),e._v(\" \"),a(\"p\",[a(\"a\",{attrs:{href:\"https://social.msdn.microsoft.com/Forums/sqlserver/en-US/edafe533-4d56-4d82-b654-9601d356675b/unit-of-timestatistics-in-client-statistics?forum=sqlgetstarted\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"ref\"),a(\"OutboundLink\")],1),e._v(\":\")]),e._v(\" \"),a(\"h2\",{attrs:{id:\"paginate\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#paginate\"}},[e._v(\"#\")]),e._v(\" Paginate\")]),e._v(\" \"),a(\"h3\",{attrs:{id:\"paginate-body\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#paginate-body\"}},[e._v(\"#\")]),e._v(\" Paginate Body\")]),e._v(\" \"),a(\"pre\",[a(\"code\",[e._v(\"USE [YourDB]\\nGO\\n\\n/****** Object:  StoredProcedure [dbo].[Paginate]    Script Date: 2020/3/11 下午 03:13:04 ******/\\nSET ANSI_NULLS ON\\nGO\\n\\nSET QUOTED_IDENTIFIER ON\\nGO\\n\\n\\n-- =============================================\\n-- Author:hkk\\n-- Create date: \\n-- Description:\\n-- =============================================\\nCREATE PROCEDURE [dbo].[Paginate] \\n    -- Add the parameters for the stored procedure here\\n    @pageSize int= 10,\\n    @whichPage int=-1,\\n    @totalPage int output,\\n    @whatToOrderBy nvarchar(50)='rowNum'\\nAS\\nBEGIN\\n-- SET NOCOUNT ON added to prevent extra result sets from\\n-- interfering with SELECT statements.\\nSET NOCOUNT ON;\\n\\n-- Insert statements for procedure here\\n\\n--Ceiling內轉為浮點數後，似乎不是輸出整數以至於C#(int)轉換跳錯\\nSELECT\\n    @totalPage = CAST(CEILING(CAST(COUNT(*) AS float) / @pageSize) AS int)\\nFROM #temp;\\n\\n\\nDECLARE @stmt nvarchar(400),\\n        @startIndex int,\\n        @paramsDefinition nvarchar(300);\\n\\n\\n-- 複製輸出格式(但不用宣告變數) UNION是為了洗掉自動識別項，讓其成為彷彿一個無自動識別的表格（之所以複製）\\nSELECT TOP (0) * INTO #takeBackDataTable FROM #temp\\nUNION ALL\\nSELECT TOP (0) * FROM #temp;\\n--SET IDENTITY_Insert #takeBackDataTable ON; --試老半天沒用\\n\\nSET @startIndex = (@whichPage - 1) * @pageSize;\\n\\n--經過實際測驗 同樣收到已經標示RowNum的資料，FETCH結論是無論WHERE或FETCH以PK作尋條件快1倍，但FETCH快WHERE 30%\\n--@whatToOrderBy的位置由於不能透過變數的方式填入（系統報錯），所以改成純用字串串接，但無Injection風險，因為其乃預存程序中指定，不會從外部填入\\nSET @stmt = '\\nINSERT INTO #takeBackDataTable SELECT * FROM  #temp ORDER BY ' + @whatToOrderBy +\\n' OFFSET @startIndex ROWS FETCH NEXT @pageSize ROWS ONLY;';\\n\\nSET @paramsDefinition = '@pageSize int,@startIndex int';\\nEXEC dbo.sp_executesql @stmt,\\n                        @paramsDefinition,\\n                        @pageSize,\\n                        @startIndex;\\n\\nSELECT * FROM #takeBackDataTable\\nEND\\nGO\\n\")])]),e._v(\" \"),a(\"p\",[e._v(\"但由傳入#temp方法不同，效能上有差異。\")]),e._v(\" \"),a(\"pre\",[a(\"code\",[e._v(\"USE [YourDB]\\nGO\\n\\n/****** Object:  StoredProcedure [dbo].[Users_Basics#Get]    Script Date: 2020/3/11 下午 03:16:27 ******/\\nSET ANSI_NULLS ON\\nGO\\n\\nSET QUOTED_IDENTIFIER ON\\nGO\\n\\n-- =============================================\\n-- Author:hkk\\n-- Create date: \\n-- Description:\\n-- =============================================\\nCREATE PROCEDURE [dbo].[Users_Basics#Get] \\n    -- Add the parameters for the stored procedure here\\n    @pageSize int = 10, \\n    @whichPage int = 1,\\n    @totalPage int output\\n\\nAS\\nBEGIN\\n    -- SET NOCOUNT ON added to prevent extra result sets from\\n    -- interfering with SELECT statements.\\n    SET NOCOUNT ON;\\n    \\n    -- Insert statements for procedure here\\n    --法1(先宣告再定PK) 需17.7毫秒\\n    /*\\n    SELECT\\n    *,\\n    ROW_NUMBER() OVER (ORDER BY createT DESC) AS rowNum INTO #temp\\n    FROM Users_Basics\\n    WHERE deleteFlag = 0;\\n    ALTER TABLE #temp ALTER COLUMN rowNum int NOT NULL;\\n    ALTER TABLE #temp ADD PRIMARY KEY NONCLUSTERED (rowNum);\\n    */\\n\\n    --法2 需11.8毫秒(先宣告空Table，再定PK，再插入資料)\\n    /*\\n    SELECT TOP (0)\\n    *,\\n    0 AS rowNum INTO #temp\\n    FROM Users_Basics\\n    UNION ALL\\n    SELECT TOP (0)\\n    *,\\n    0 AS rowNum\\n    FROM Users_Basics;\\n    ALTER TABLE #temp ALTER COLUMN rowNum int NOT NULL;\\n    ALTER TABLE #temp ADD PRIMARY KEY NONCLUSTERED (rowNum);\\n    INSERT INTO #temp\\n    SELECT\\n        *,\\n        ROW_NUMBER() OVER (ORDER BY createT DESC) AS rowNum\\n    FROM Users_Basics\\n    WHERE deleteFlag = 0;\\n    */\\n\\n    --法3 需7.8毫秒(正式宣告Table，再插入資料)\\n    \\n    CREATE TABLE #temp (\\n\\n    [id] [int] NOT NULL,\\n    [accountName] [nvarchar](100) NOT NULL,\\n    [ps] [nchar](34) NOT NULL,\\n    [alias] [nvarchar](20) NULL,\\n    [createT] [datetime] NOT NULL,\\n    [gender] [bit] NULL,\\n    [deleteFlag] [bit] NULL,\\n    rowNum int NOT NULL\\n    PRIMARY KEY (rowNum)\\n    );\\n\\n    INSERT INTO #temp\\n    SELECT\\n        *,\\n        ROW_NUMBER() OVER (ORDER BY createT DESC) AS rowNum\\n    FROM Users_Basics\\n    WHERE deleteFlag = 0;\\n\\n\\n    EXEC [dbo].[Paginate] @pageSize,\\n                        @whichPage,\\n                        @totalPage,\\n                        'rowNum';\\n\\nEND\\nGO\\n\")])])])}),[],!1,null,null,null);t.default=r.exports}}]);","extractedComments":[]}